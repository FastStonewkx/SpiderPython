# 会话和Cookies

## 静态页面和动态页面

静态页面：最基本的页面，文字，图片等内容均通过写好的html代码指定。
特点：加载速度快，编写简单，可维护性差，不能根据url灵活多变地显示内容。
例如无法做到给静态页面传入一个参数，让其在页面中显示出来。

动态页面：动态解析url中参数的变化，关联数据库并动态呈现不同的页面内容。
页面不再是一个简单的html，而可能由jsp，php，python等语言编写。功能比静态页面强太多

## 无状态HTTP

http的无状态是指http协议对事务处理是没有记忆功能的，也就是说服务器不知道客户端是什么状态。
既当向服务器发请求时候，服务器解析此请求，返回响应，服务器完成这个过程是独立的，不会记忆前后状态变化，也就是说缺少状态记录。
意味着若后续需要处理前面的响应必须重传，导致需要传递一些前面的重复请求。浪费资源

用于保持http连接状态的技术：会话和cookies

会话在服务器端，也就是网站的服务器，用来保存用户的会话信息。
cookies在客户端，理解为浏览器端，浏览器会在下次访问网页时自动附上cookies发送给服务端（判断用户状态），用户就不需要重复登陆，返回相应的响应。

### 1. 会话
web中，会话对象用来存储特定用户会话所需的属性及配置信息

当用户在页面将跳转，会话中的变量不会丢失，而是在整个用户会话一直存在。当会话过期或者被放弃后，服务器将终止。

### 2. Cookies
Cookies指某些网站为了辨别用户身份、进行会话跟踪而存储在浏览器上的数据。

####  会话维持

-  客户第一次请求服务器，服务器返回一个请求头带有set-cookie字段的响应给客户端，标记是哪个用户，浏览器把cookies保存起来
-  客户第二次请求，浏览器会把此Cookies放到请求头提交给服务器，cookie携带了会话id，服务器检查该cookies可找到对应的会话，以此判断用户状态

cookies和会话需要配合，两者共同协作，实现了会话控制。

#### 属性结构

cookies由哪些属性
- Name：Cookie的名称。一旦创建不可更改
- Value：Cookie的值。如果值为Unicode字符，需要为字符编码。如果值为二进制数据，则需要使用BASE64
- Domain：可以访问该Cookie的域名。例如，如果设置为.zhihu.com。则所有以zhihu.com结尾的域名都可以访问该Cookie
- Max Age：该Cookie的失效时间，单位为秒，也常和Expire使用。正数，则在Max Age秒后失效，负数则立即失效，浏览器不再以任何形式保存该Cookie
- Path：该Cookie的使用路径，若设置/path/路径，则只有/path/的页面可以访问该Cookie。如果设置为/，则本域名下所有页面都可以访问该Cookie
- Size字段：此Cookie大小
- HTTP字段：Cookie的httponly属性。为true，则只有在HTTP头会带有该Cookie的信息，而不能通过document.cookie来访问此Cookie
- Secure：该Cookie是否仅被使用安全协议传输。安全协议有https和ssl等，在网络上传输数据之前先将数据加密。默认为false

#### 会话Cookie和持久Cookie
这个知识个概念。本身不严谨，就是把Cookie的有效时间和会话有效器设置的比较久，实现长时间登陆的目的

### 常见问题

关闭浏览器，并不会使得会话失效。
大部分会话机制使用会话Cookie来保存会话ID，关闭浏览器后，Cookie消失，再次连接服务器，就无法找到原来的会话了
但是假如服务器设置的Cookie保存到硬盘上，或者使用某种手段改写浏览器发出的HTTP请求头，把原来的Cookies发送给服务器。则再次打开浏览器，仍能找到原来的会话，依旧保持登录状态。

所以这时候服务器为会话设置了失效时间。

